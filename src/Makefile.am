## Process this file with automake to produce Makefile.in

SUBDIRS = . tests

NULL =

EXTRA_DIST =

INCLUDES = \
	-I$(top_builddir)/src -I$(top_srcdir)/src 		\
	-DPACKAGE_LIBEXEC_DIR=\""$(libexecdir)"\" 		\
	-DPACKAGE_SYSCONF_DIR=\""$(sysconfdir)"\" 		\
	-DPACKAGE_DATA_DIR=\""$(datadir)"\" 			\
	-DPACKAGE_BIN_DIR=\""$(bindir)"\" 			\
	-DPACKAGE_LOCALSTATE_DIR=\""$(localstatedir)"\" 	\
	-DPACKAGE_LOCALE_DIR=\""$(localedir)"\" 		\
	-DPACKAGE_LIB_DIR=\""$(libdir)"\" 			\
	-D_POSIX_PTHREAD_SEMANTICS -D_REENTRANT			\
	-DUDISKS_API_IS_SUBJECT_TO_CHANGE			\
	$(POLKIT_GOBJECT_1_CFLAGS) 				\
	$(GUDEV_CFLAGS) 					\
	$(GLIB_CFLAGS) 						\
	$(GIO_CFLAGS)						\
	$(NULL)

# ----------------------------------------------------------------------------------------------------

BUILT_SOURCES = 							\
	udisks-daemon-marshal.h		udisks-daemon-marshal.c		\
	$(NULL)

udisks-daemon-marshal.h: udisks-daemon-marshal.list
	glib-genmarshal $< --prefix=udisks_daemon_marshal --header > $@

udisks-daemon-marshal.c: udisks-daemon-marshal.list
	echo "#include \"udisks-daemon-marshal.h\"" > $@ && glib-genmarshal $< --prefix=udisks_daemon_marshal --body >> $@

EXTRA_DIST += udisks-daemon-marshal.list

# ----------------------------------------------------------------------------------------------------

noinst_LTLIBRARIES = libudisks-daemon.la

libudisks_daemon_la_SOURCES =						\
	types.h								\
	gposixsignal.h			gposixsignal.c			\
	udisksdaemon.h			udisksdaemon.c			\
	udiskslinuxprovider.h		udiskslinuxprovider.c		\
	udiskslinuxblock.h		udiskslinuxblock.c		\
	udisksfilesystemimpl.h		udisksfilesystemimpl.c		\
	udisksspawnedjob.h		udisksspawnedjob.c		\
	$(BUILT_SOURCES)						\
	$(NULL)

libudisks_daemon_la_CFLAGS =				\
	-I$(top_srcdir)					\
	-DG_LOG_DOMAIN=\"udisks-daemon\"		\
	$(GLIB_CFLAGS)					\
	$(GIO_CFLAGS)					\
	$(GUDEV_CFLAGS)					\
	$(LIBATASMART_CFLAGS)				\
	$(POLKIT_GOBJECT_1_CFLAGS) 			\
	$(NULL)

libudisks_daemon_la_LIBADD =				\
	$(GLIB_LIBS)					\
	$(GIO_LIBS)					\
	$(GUDEV_LIBS)					\
	$(LIBATASMART_LIBS)				\
	$(POLKIT_GOBJECT_1_LIBS) 			\
	$(top_builddir)/udisks/libudisks.la		\
	$(NULL)

# ----------------------------------------------------------------------------------------------------

libexec_PROGRAMS = udisks-daemon

udisks_daemon_SOURCES = 				\
				main.c			\
	$(NULL)

udisks_daemon_CFLAGS = 					\
	-DG_LOG_DOMAIN=\"udisks-daemon\"		\
	$(LIBATASMART_CFLAGS)				\
	$(NULL)

udisks_daemon_LDADD = 					\
	$(GLIB_LIBS)					\
	$(GIO_LIBS)					\
	$(top_builddir)/src/libudisks-daemon.la		\
	$(NULL)

# ----------------------------------------------------------------------------------------------------

install-data-local:
	-$(mkdir_p) $(DESTDIR)$(localstatedir)/lib/udisks
	-chmod 0700 $(DESTDIR)$(localstatedir)/lib/udisks
	-$(mkdir_p) $(DESTDIR)$(localstatedir)/run/udisks
	-chmod 0700 $(DESTDIR)$(localstatedir)/run/udisks
